{"ast":null,"code":"var _jsxFileName = \"D:\\\\Vo Nguyen Hoanh Hop_J Liff\\\\CNMoi\\\\Hop_feature\\\\realtime-translate-mvc\\\\frontend\\\\src\\\\components\\\\VideoChat.jsx\";\n// frontend/src/components/VideoChat.jsx\nimport React, { useRef, useEffect, useState } from 'react';\nimport useSocket from '../hooks/useSocket';\nexport default function VideoChat() {\n  const localVideo = useRef(null);\n  const [translation, setTranslation] = useState('');\n  const socket = useSocket();\n  useEffect(() => {\n    if (!socket) return;\n\n    // Debug: khi kết nối thành công\n    socket.on('connect', () => {\n      console.log('Socket.IO connected, id=', socket.id);\n    });\n    socket.on('connect_error', err => {\n      console.error('Socket.IO connect_error', err);\n    });\n\n    // Nhận bản dịch từ server\n    socket.on('translation', data => {\n      console.log('Received translation:', data.text);\n      setTranslation(data.text);\n    });\n\n    // Lấy media và khởi audio processing\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      localVideo.current.srcObject = stream;\n\n      // Tạo AudioContext với sampleRate 16000\n      const AudioContextClass = window.AudioContext || window.webkitAudioContext;\n      const audioContext = new AudioContextClass({\n        sampleRate: 16000\n      });\n      const source = audioContext.createMediaStreamSource(stream);\n\n      // Deprecated nhưng đơn giản: ScriptProcessorNode\n      // @ts-ignore: using deprecated API\n      const processor = audioContext.createScriptProcessor(4096, 1, 1);\n      source.connect(processor);\n      processor.connect(audioContext.destination);\n\n      // Mỗi khi có buffer mới, convert Float32 → Int16 và emit\n      // @ts-ignore: deprecated onaudioprocess\n      processor.onaudioprocess = e => {\n        // @ts-ignore: deprecated inputBuffer\n        const input = e.inputBuffer.getChannelData(0);\n        const pcm = new Int16Array(input.length);\n        for (let i = 0; i < input.length; i++) {\n          let s = Math.max(-1, Math.min(1, input[i]));\n          pcm[i] = s < 0 ? s * 0x8000 : s * 0x7FFF;\n        }\n        console.log('Sending audio chunk, bytes:', pcm.buffer.byteLength);\n        socket.emit('audio_chunk', pcm.buffer);\n      };\n    }).catch(err => {\n      console.error('getUserMedia error:', err);\n    });\n\n    // Cleanup khi component unmount\n    return () => {\n      socket.off('connect');\n      socket.off('connect_error');\n      socket.off('translation');\n    };\n  }, [socket]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"p-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"text-xl font-semibold mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }\n  }, \"Real-time Translate\"), /*#__PURE__*/React.createElement(\"video\", {\n    ref: localVideo,\n    autoPlay: true,\n    muted: true,\n    className: \"w-80 h-60 rounded-md shadow-md mb-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"text-base\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 9\n    }\n  }, \"Translation:\"), \" \", translation));\n}","map":{"version":3,"names":["React","useRef","useEffect","useState","useSocket","VideoChat","localVideo","translation","setTranslation","socket","on","console","log","id","err","error","data","text","navigator","mediaDevices","getUserMedia","video","audio","then","stream","current","srcObject","AudioContextClass","window","AudioContext","webkitAudioContext","audioContext","sampleRate","source","createMediaStreamSource","processor","createScriptProcessor","connect","destination","onaudioprocess","e","input","inputBuffer","getChannelData","pcm","Int16Array","length","i","s","Math","max","min","buffer","byteLength","emit","catch","off","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","muted"],"sources":["D:/Vo Nguyen Hoanh Hop_J Liff/CNMoi/Hop_feature/realtime-translate-mvc/frontend/src/components/VideoChat.jsx"],"sourcesContent":["// frontend/src/components/VideoChat.jsx\nimport React, { useRef, useEffect, useState } from 'react';\nimport useSocket from '../hooks/useSocket';\n\nexport default function VideoChat() {\n  const localVideo = useRef(null);\n  const [translation, setTranslation] = useState('');\n  const socket = useSocket();\n\n  useEffect(() => {\n    if (!socket) return;\n\n    // Debug: khi kết nối thành công\n    socket.on('connect', () => {\n      console.log('Socket.IO connected, id=', socket.id);\n    });\n    socket.on('connect_error', (err) => {\n      console.error('Socket.IO connect_error', err);\n    });\n\n    // Nhận bản dịch từ server\n    socket.on('translation', (data) => {\n      console.log('Received translation:', data.text);\n      setTranslation(data.text);\n    });\n\n    // Lấy media và khởi audio processing\n    navigator.mediaDevices.getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        localVideo.current.srcObject = stream;\n\n        // Tạo AudioContext với sampleRate 16000\n        const AudioContextClass = window.AudioContext || window.webkitAudioContext;\n        const audioContext = new AudioContextClass({ sampleRate: 16000 });\n        const source = audioContext.createMediaStreamSource(stream);\n\n        // Deprecated nhưng đơn giản: ScriptProcessorNode\n        // @ts-ignore: using deprecated API\n        const processor = audioContext.createScriptProcessor(4096, 1, 1);\n        source.connect(processor);\n        processor.connect(audioContext.destination);\n\n        // Mỗi khi có buffer mới, convert Float32 → Int16 và emit\n        // @ts-ignore: deprecated onaudioprocess\n        processor.onaudioprocess = (e) => {\n          // @ts-ignore: deprecated inputBuffer\n          const input = e.inputBuffer.getChannelData(0);\n          const pcm = new Int16Array(input.length);\n          for (let i = 0; i < input.length; i++) {\n            let s = Math.max(-1, Math.min(1, input[i]));\n            pcm[i] = s < 0 ? s * 0x8000 : s * 0x7FFF;\n          }\n          console.log('Sending audio chunk, bytes:', pcm.buffer.byteLength);\n          socket.emit('audio_chunk', pcm.buffer);\n        };\n      })\n      .catch((err) => {\n        console.error('getUserMedia error:', err);\n      });\n\n    // Cleanup khi component unmount\n    return () => {\n      socket.off('connect');\n      socket.off('connect_error');\n      socket.off('translation');\n    };\n  }, [socket]);\n\n  return (\n    <div className=\"p-4\">\n      <h2 className=\"text-xl font-semibold mb-2\">Real-time Translate</h2>\n      <video\n        ref={localVideo}\n        autoPlay\n        muted\n        className=\"w-80 h-60 rounded-md shadow-md mb-4\"\n      />\n      <p className=\"text-base\">\n        <strong>Translation:</strong> {translation}\n      </p>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}